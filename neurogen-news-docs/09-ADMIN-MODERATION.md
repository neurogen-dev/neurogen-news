# Роли, Модерация и Администрирование Neurogen.News

## Обзор

Данный документ описывает:
- Систему ролей и прав доступа
- Функционал модерации контента
- Управление подсайтами
- Административную панель

---

## Система ролей

### Иерархия ролей

```
┌─────────────────────────────────────────────────────────────────────────┐
│                              ADMIN                                       │
│                    Полный доступ к платформе                            │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                          EDITOR                                    │  │
│  │                Редакция, редакционный контент                     │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │                    MODERATOR                                 │  │  │
│  │  │              Модерация контента и пользователей              │  │  │
│  │  │  ┌─────────────────────────────────────────────────────┐    │  │  │
│  │  │  │                    AUTHOR                            │    │  │  │
│  │  │  │          Публикация контента без премодерации        │    │  │  │
│  │  │  │  ┌─────────────────────────────────────────────┐    │    │  │  │
│  │  │  │  │                  USER                        │    │    │  │  │
│  │  │  │  │      Базовые права (чтение, комментарии)     │    │    │  │  │
│  │  │  │  └─────────────────────────────────────────────┘    │    │  │  │
│  │  │  └─────────────────────────────────────────────────────┘    │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
```

### Матрица прав доступа

| Действие | USER | AUTHOR | MODERATOR | EDITOR | ADMIN |
|----------|------|--------|-----------|--------|-------|
| **Контент** |
| Читать публичный контент | ✅ | ✅ | ✅ | ✅ | ✅ |
| Комментировать | ✅ | ✅ | ✅ | ✅ | ✅ |
| Ставить реакции | ✅ | ✅ | ✅ | ✅ | ✅ |
| Добавлять в закладки | ✅ | ✅ | ✅ | ✅ | ✅ |
| Создавать публикации (UGC) | 🔸* | ✅ | ✅ | ✅ | ✅ |
| Публикации без премодерации | ❌ | ✅ | ✅ | ✅ | ✅ |
| Создавать редакционный контент | ❌ | ❌ | ❌ | ✅ | ✅ |
| **Модерация** |
| Жаловаться на контент | ✅ | ✅ | ✅ | ✅ | ✅ |
| Просматривать очередь модерации | ❌ | ❌ | ✅ | ✅ | ✅ |
| Скрывать/восстанавливать контент | ❌ | ❌ | ✅ | ✅ | ✅ |
| Редактировать чужой контент | ❌ | ❌ | ❌ | ✅ | ✅ |
| Банить пользователей | ❌ | ❌ | ✅ | ✅ | ✅ |
| **Подсайты** |
| Подписываться на подсайты | ✅ | ✅ | ✅ | ✅ | ✅ |
| Публиковать в подсайты | 🔸* | ✅ | ✅ | ✅ | ✅ |
| Создавать подсайты | ❌ | ❌ | ❌ | ❌ | ✅ |
| Управлять подсайтами | ❌ | ❌ | ❌ | 🔸** | ✅ |
| **Администрирование** |
| Доступ к админ-панели | ❌ | ❌ | ✅ | ✅ | ✅ |
| Управление ролями | ❌ | ❌ | ❌ | ❌ | ✅ |
| Глобальные настройки | ❌ | ❌ | ❌ | ❌ | ✅ |
| Аналитика платформы | ❌ | ❌ | ❌ | ✅ | ✅ |

> *🔸 — с премодерацией или ограничениями  
> **🔸 — только назначенные подсайты

---

## USER (Обычный пользователь)

### Базовые возможности

```
┌────────────────────────────────────────────────────────────────────────┐
│  ПОЛЬЗОВАТЕЛЬ (USER)                                                    │
├────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ✅ РАЗРЕШЕНО                        ❌ ЗАПРЕЩЕНО                        │
│  ─────────────                       ───────────                         │
│  • Чтение контента                   • Публикация без модерации         │
│  • Комментирование                   • Доступ к админ-панели            │
│  • Реакции и закладки                • Модерация чужого контента        │
│  • Редактирование профиля            • Создание подсайтов               │
│  • Подписки на авторов/темы          • Управление ролями                │
│  • Личные сообщения                                                      │
│  • Жалобы на контент                                                    │
│  • Публикация с премодерацией*                                          │
│                                                                          │
│  * Если включена функция UGC                                            │
│                                                                          │
└────────────────────────────────────────────────────────────────────────┘
```

### Ограничения для новых пользователей

Для борьбы со спамом и злоупотреблениями применяются ограничения:

| Метрика | Новый (< 7 дней) | Обычный | С karma > 100 |
|---------|------------------|---------|---------------|
| Комментарии в час | 5 | 30 | 60 |
| Публикации в день | 1 (с премод.) | 3 (с премод.) | 10 |
| Личные сообщения | ❌ | 10/день | ∞ |
| Загрузка медиа | 5 MB | 25 MB | 100 MB |
| Редактирование комментария | 15 мин | 60 мин | ∞ |

### Повышение до AUTHOR

Автоматическое повышение до AUTHOR происходит при выполнении условий:

```typescript
const AUTHOR_REQUIREMENTS = {
  karma: 50,                    // Минимальная карма
  accountAge: 14,               // Дней с регистрации
  publishedArticles: 3,         // Опубликованных статей (прошли модерацию)
  rejectedRate: 0.3,            // Не более 30% отклонённых
  noActiveBans: true            // Нет активных банов
};
```

---

## AUTHOR (Автор)

### Расширенные возможности

```
┌────────────────────────────────────────────────────────────────────────┐
│  АВТОР (AUTHOR)                                                         │
├────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ВСЁ ИЗ USER +                                                          │
│  ─────────────                                                          │
│                                                                          │
│  📝 ПУБЛИКАЦИИ                                                          │
│  • Публикация без премодерации                                          │
│  • Редактирование своих статей                                          │
│  • Удаление своих статей                                                │
│  • Доступ к черновикам                                                  │
│  • История версий статей                                                │
│                                                                          │
│  📊 АНАЛИТИКА                                                           │
│  • Статистика просмотров                                                │
│  • Источники трафика                                                    │
│  • Демография читателей                                                 │
│  • Популярные статьи                                                    │
│                                                                          │
│  💰 МОНЕТИЗАЦИЯ                                                         │
│  • Подключение донатов                                                  │
│  • Партнёрская программа                                                │
│  • Premium-контент (Plus)                                               │
│                                                                          │
└────────────────────────────────────────────────────────────────────────┘
```

### Аналитика автора

```
┌────────────────────────────────────────────────────────────────────────┐
│  📊 Моя статистика                                     [Экспорт CSV]    │
├────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  Период: [Последние 30 дней ▼]                                          │
│                                                                          │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐   │
│  │   12,456     │ │     342      │ │     89       │ │    +156      │   │
│  │  Просмотров  │ │ Комментариев │ │   Реакций    │ │ Подписчиков  │   │
│  │   ▲ +24%     │ │    ▲ +12%    │ │    ▼ -5%     │ │   ▲ +8%      │   │
│  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘   │
│                                                                          │
│  📈 ДИНАМИКА ПРОСМОТРОВ                                                 │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │  [График линейный за выбранный период]                           │  │
│  └──────────────────────────────────────────────────────────────────┘  │
│                                                                          │
│  🏆 ТОП СТАТЕЙ                                                          │
│  ┌───────────────────────────────────────────────────────┬──────────┐  │
│  │  1. Как начать с ChatGPT за 5 минут                   │  5,234 👁 │  │
│  │  2. Midjourney vs DALL-E: полное сравнение            │  3,102 👁 │  │
│  │  3. 50 промптов для копирайтинга                      │  2,890 👁 │  │
│  └───────────────────────────────────────────────────────┴──────────┘  │
│                                                                          │
│  📍 ИСТОЧНИКИ ТРАФИКА                                                   │
│  • Поиск (Google/Yandex): 45%                                           │
│  • Лента Neurogen.News: 30%                                             │
│  • Социальные сети: 15%                                                 │
│  • Прямые переходы: 10%                                                 │
│                                                                          │
└────────────────────────────────────────────────────────────────────────┘
```

---

## MODERATOR (Модератор)

### Функционал модератора

```
┌────────────────────────────────────────────────────────────────────────┐
│  МОДЕРАТОР (MODERATOR)                                                  │
├────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ВСЁ ИЗ AUTHOR +                                                        │
│  ──────────────                                                         │
│                                                                          │
│  🛡️ МОДЕРАЦИЯ КОНТЕНТА                                                 │
│  • Очередь на модерацию                                                 │
│  • Одобрение/отклонение публикаций                                      │
│  • Скрытие/восстановление контента                                      │
│  • Закрепление/открепление постов                                       │
│  • Перенос в другой подсайт                                             │
│                                                                          │
│  👥 МОДЕРАЦИЯ ПОЛЬЗОВАТЕЛЕЙ                                             │
│  • Просмотр истории пользователя                                        │
│  • Предупреждения                                                       │
│  • Временный бан (до 30 дней)                                           │
│  • Бан в комментариях                                                   │
│  • Mute (без уведомлений)                                               │
│                                                                          │
│  📋 ЖАЛОБЫ                                                              │
│  • Обработка жалоб                                                      │
│  • Закрытие жалоб с резолюцией                                          │
│  • Эскалация сложных случаев                                            │
│                                                                          │
│  ⚠️ ОГРАНИЧЕНИЯ                                                        │
│  • Не может банить навсегда                                             │
│  • Не может редактировать чужой контент                                 │
│  • Не может менять роли                                                 │
│  • Действия логируются                                                  │
│                                                                          │
└────────────────────────────────────────────────────────────────────────┘
```

### Панель модератора

```
┌────────────────────────────────────────────────────────────────────────┐
│  🛡️ Панель модерации                                                   │
├─────────────────┬──────────────────────────────────────────────────────┤
│                 │                                                        │
│  📋 Очередь     │  ОЧЕРЕДЬ МОДЕРАЦИИ                     [Фильтры ▼]   │
│     (23)        │                                                        │
│                 │  ┌────────────────────────────────────────────────┐   │
│  🚨 Жалобы      │  │  [!] Статья от @newuser                        │   │
│     (12)        │  │  "Как заработать на нейросетях 100500$"        │   │
│                 │  │  💬 Чат-боты • 15 мин назад                    │   │
│  ✅ Решённые    │  │                                                 │   │
│     (156)       │  │  Причина: Автоматическая (новый пользователь)  │   │
│                 │  │                                                 │   │
│  📊 Статистика  │  │  [👁 Просмотр] [✅ Одобрить] [❌ Отклонить]     │   │
│                 │  └────────────────────────────────────────────────┘   │
│  ⚙️ Настройки   │                                                        │
│                 │  ┌────────────────────────────────────────────────┐   │
│                 │  │  [!] Статья от @author123                      │   │
│                 │  │  "Обзор новых функций Claude 3.5"              │   │
│                 │  │  🔍 Обзоры • 2ч назад                          │   │
│                 │  │                                                 │   │
│                 │  │  Причина: Жалоба (спам)                        │   │
│                 │  │  Жалоб: 3                                       │   │
│                 │  │                                                 │   │
│                 │  │  [👁 Просмотр] [✅ Оставить] [❌ Скрыть]        │   │
│                 │  └────────────────────────────────────────────────┘   │
│                 │                                                        │
└─────────────────┴──────────────────────────────────────────────────────┘
```

### Действия с контентом

| Действие | Описание | Уведомление автору |
|----------|----------|-------------------|
| **Одобрить** | Публикация появляется в ленте | ✅ "Статья опубликована" |
| **Отклонить** | Статья возвращается в черновики | ✅ С причиной отклонения |
| **Скрыть** | Статья скрыта из публичного доступа | ✅ С причиной скрытия |
| **Восстановить** | Ранее скрытая статья снова видна | ✅ "Статья восстановлена" |
| **Перенести** | Статья перемещена в другой подсайт | ✅ С указанием нового подсайта |
| **Закрепить** | Статья закреплена в подсайте | ❌ |
| **Отметить NSFW** | Контент скрыт под предупреждением | ✅ |

### Действия с пользователями

```
┌────────────────────────────────────────────────────────────────────────┐
│  👤 Профиль пользователя @username                    [Модератору]     │
├────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ИНФОРМАЦИЯ                                                              │
│  ├─ Регистрация: 15.03.2025                                             │
│  ├─ Karma: +256                                                          │
│  ├─ Статей: 12                                                           │
│  ├─ Комментариев: 89                                                     │
│  └─ Предупреждений: 1                                                   │
│                                                                          │
│  ИСТОРИЯ НАРУШЕНИЙ                                                       │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │  ⚠️ 10.11.2025 — Предупреждение (оскорбления)                    │   │
│  │     Модератор: @mod1 • "Нарушение правил в комментариях"         │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│                                                                          │
│  ДЕЙСТВИЯ                                                                │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐   │
│  │  ⚠️          │ │  🔇          │ │  ⛔          │ │  📋          │   │
│  │ Предупредить │ │    Mute      │ │    Бан      │ │   История    │   │
│  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘   │
│                                                                          │
└────────────────────────────────────────────────────────────────────────┘
```

### Типы санкций

| Санкция | Описание | Срок | Кто может применить |
|---------|----------|------|---------------------|
| **Предупреждение** | Фиксируется в истории | — | Модератор+ |
| **Mute** | Уведомления отключены | 1-7 дней | Модератор+ |
| **Бан комментариев** | Запрет комментировать | 1-30 дней | Модератор+ |
| **Временный бан** | Полный запрет активности | 1-30 дней | Модератор+ |
| **Постоянный бан** | Блокировка аккаунта | ∞ | Admin только |
| **Shadow ban** | Скрытая блокировка | По решению | Admin только |

---

## EDITOR (Редактор)

### Функционал редакции

```
┌────────────────────────────────────────────────────────────────────────┐
│  РЕДАКТОР (EDITOR)                                                      │
├────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ВСЁ ИЗ MODERATOR +                                                     │
│  ─────────────────                                                      │
│                                                                          │
│  ✍️ РЕДАКЦИОННЫЙ КОНТЕНТ                                               │
│  • Создание материалов редакции (бейдж "Материал редакции")            │
│  • Редактирование любого контента                                       │
│  • Приоритетное размещение в ленте                                      │
│  • SEO-оптимизация статей                                               │
│  • Планирование публикаций                                              │
│                                                                          │
│  📰 КОНТЕНТ-ПЛАН                                                        │
│  • Календарь публикаций                                                 │
│  • Редакционные задачи                                                  │
│  • Совместное редактирование                                            │
│  • Версионирование и откат                                              │
│                                                                          │
│  🏷️ УПРАВЛЕНИЕ КОНТЕНТОМ                                               │
│  • Создание и управление тегами                                         │
│  • Управление назначенными подсайтами                                   │
│  • Верификация авторов                                                  │
│  • Приглашение авторов                                                  │
│                                                                          │
│  📊 РАСШИРЕННАЯ АНАЛИТИКА                                               │
│  • Аналитика по подсайтам                                               │
│  • Отчёты по контенту                                                   │
│  • A/B тестирование заголовков                                          │
│  • SEO-метрики                                                          │
│                                                                          │
└────────────────────────────────────────────────────────────────────────┘
```

### Редакционный дашборд

```
┌────────────────────────────────────────────────────────────────────────┐
│  ✍️ Редакция                                                            │
├─────────────────┬──────────────────────────────────────────────────────┤
│                 │                                                        │
│  📅 Календарь   │  КАЛЕНДАРЬ ПУБЛИКАЦИЙ                                 │
│                 │                                                        │
│  📝 Черновики   │  ┌─────┬─────┬─────┬─────┬─────┬─────┬─────┐         │
│     редакции    │  │ Пн  │ Вт  │ Ср  │ Чт  │ Пт  │ Сб  │ Вс  │         │
│                 │  ├─────┼─────┼─────┼─────┼─────┼─────┼─────┤         │
│  📊 Аналитика   │  │     │ 📄  │     │ 📄  │ 📄  │     │     │         │
│                 │  │     │10:00│     │12:00│09:00│     │     │         │
│  👥 Авторы      │  └─────┴─────┴─────┴─────┴─────┴─────┴─────┘         │
│                 │                                                        │
│  🏷️ Теги        │  БЛИЖАЙШИЕ ПУБЛИКАЦИИ                                 │
│                 │  ┌────────────────────────────────────────────────┐   │
│  ⚙️ Настройки   │  │  📄 Обзор GPT-5: что нового?                   │   │
│                 │  │     Вт, 10:00 • @editor1 • 💬 Чат-боты          │   │
│                 │  │     [✏️ Редактировать] [⏰ Перенести] [🗑]      │   │
│                 │  └────────────────────────────────────────────────┘   │
│                 │  ┌────────────────────────────────────────────────┐   │
│                 │  │  📄 Midjourney v7: полный гайд                 │   │
│                 │  │     Чт, 12:00 • @editor2 • 🎨 Изображения       │   │
│                 │  │     [✏️ Редактировать] [⏰ Перенести] [🗑]      │   │
│                 │  └────────────────────────────────────────────────┘   │
│                 │                                                        │
└─────────────────┴──────────────────────────────────────────────────────┘
```

### Редактирование чужого контента

При редактировании чужих статей редактор видит:

```
┌────────────────────────────────────────────────────────────────────────┐
│  ✏️ Редактирование статьи                              [История] [💾]   │
├────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ⚠️ Вы редактируете статью автора @username                            │
│  Все изменения будут сохранены в истории версий.                        │
│                                                                          │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │  ЗАГОЛОВОК СТАТЬИ                                                │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│                                                                          │
│  [Содержимое редактора...]                                              │
│                                                                          │
├────────────────────────────────────────────────────────────────────────┤
│  Причина редактирования (обязательно):                                  │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │  Исправление орфографических ошибок                              │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│                                                                          │
│  ☐ Уведомить автора об изменениях                                       │
│                                                                          │
│  [Отмена]                                    [Сохранить изменения]      │
│                                                                          │
└────────────────────────────────────────────────────────────────────────┘
```

### История версий

```
┌────────────────────────────────────────────────────────────────────────┐
│  📜 История версий: "Как начать с ChatGPT"                              │
├────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │  v5 (текущая) • 15.11.2025, 14:30                                │   │
│  │  @editor1 • "Исправление орфографических ошибок"                 │   │
│  │                                        [Сравнить] [Восстановить] │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │  v4 • 14.11.2025, 10:15                                          │   │
│  │  @author123 • "Добавлен раздел про GPT-4 Turbo"                  │   │
│  │                                        [Сравнить] [Восстановить] │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │  v3 • 10.11.2025, 09:00                                          │   │
│  │  @editor2 • "SEO-оптимизация заголовка"                          │   │
│  │                                        [Сравнить] [Восстановить] │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│                                                                          │
│  [Показать все версии]                                                  │
│                                                                          │
└────────────────────────────────────────────────────────────────────────┘
```

---

## ADMIN (Администратор)

### Полномочия администратора

```
┌────────────────────────────────────────────────────────────────────────┐
│  АДМИНИСТРАТОР (ADMIN)                                                  │
├────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ВСЁ ИЗ EDITOR +                                                        │
│  ──────────────                                                         │
│                                                                          │
│  🔐 УПРАВЛЕНИЕ ДОСТУПОМ                                                 │
│  • Назначение и отзыв ролей                                             │
│  • Создание админ-аккаунтов                                             │
│  • Постоянные баны                                                      │
│  • Shadow-баны                                                          │
│  • IP-баны                                                              │
│                                                                          │
│  🏗️ УПРАВЛЕНИЕ ПЛАТФОРМОЙ                                              │
│  • Создание и удаление подсайтов                                        │
│  • Глобальные настройки                                                 │
│  • Правила модерации                                                    │
│  • Настройка автомодерации                                              │
│                                                                          │
│  💰 МОНЕТИЗАЦИЯ                                                         │
│  • Управление рекламой                                                  │
│  • Настройки Plus-подписки                                              │
│  • Партнёрская программа                                                │
│  • Финансовые отчёты                                                    │
│                                                                          │
│  🔧 ТЕХНИЧЕСКИЕ НАСТРОЙКИ                                               │
│  • SEO-настройки                                                        │
│  • Интеграции (OAuth, API)                                              │
│  • Резервное копирование                                                │
│  • Логи системы                                                         │
│                                                                          │
└────────────────────────────────────────────────────────────────────────┘
```

### Административная панель

```
┌────────────────────────────────────────────────────────────────────────┐
│  🔧 Админ-панель Neurogen.News                                          │
├─────────────────┬──────────────────────────────────────────────────────┤
│                 │                                                        │
│  📊 Дашборд     │  ОБЗОР ПЛАТФОРМЫ                       [Обновить]    │
│                 │                                                        │
│  👥 Пользователи│  ┌───────────────┐ ┌───────────────┐ ┌─────────────┐ │
│                 │  │   45,678      │ │    1,234      │ │    12       │ │
│  📝 Контент     │  │ Пользователей │ │  За сегодня   │ │   Онлайн    │ │
│                 │  │    ▲ +5%      │ │    ▲ +12%     │ │             │ │
│  📁 Подсайты    │  └───────────────┘ └───────────────┘ └─────────────┘ │
│                 │                                                        │
│  🛡️ Модерация   │  ┌───────────────┐ ┌───────────────┐ ┌─────────────┐ │
│                 │  │   156,789     │ │    5,678      │ │   89,012    │ │
│  💰 Финансы     │  │    Статей     │ │  За неделю    │ │ Комментариев│ │
│                 │  │    ▲ +8%      │ │    ▲ +3%      │ │   ▲ +15%    │ │
│  📢 Реклама     │  └───────────────┘ └───────────────┘ └─────────────┘ │
│                 │                                                        │
│  ⚙️ Настройки   │  📈 АКТИВНОСТЬ ЗА НЕДЕЛЮ                              │
│                 │  ┌──────────────────────────────────────────────────┐ │
│  📋 Логи        │  │  [График: просмотры, регистрации, публикации]   │ │
│                 │  └──────────────────────────────────────────────────┘ │
│  🔌 Интеграции  │                                                        │
│                 │  🚨 ТРЕБУЕТ ВНИМАНИЯ                                   │
│                 │  • 23 статьи в очереди модерации                      │
│                 │  • 12 открытых жалоб                                   │
│                 │  • 3 заблокированных пользователя ожидают апелляции   │
│                 │                                                        │
└─────────────────┴──────────────────────────────────────────────────────┘
```

### Управление пользователями

```
┌────────────────────────────────────────────────────────────────────────┐
│  👥 Управление пользователями                                           │
├────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  🔍 [Поиск по email, username, ID...]           [Фильтры ▼] [Экспорт]  │
│                                                                          │
│  Роль: [Все ▼]  Статус: [Все ▼]  Период: [Все время ▼]                 │
│                                                                          │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │  [Avatar] @username                                               │   │
│  │  email@example.com                                                │   │
│  │  Роль: AUTHOR  •  Karma: +256  •  С: 15.03.2025                  │   │
│  │  Статус: ✅ Активен                                               │   │
│  │                                                                   │   │
│  │  [👁 Просмотр] [✏️ Роль ▼] [⛔ Бан] [🗑 Удалить]                 │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│                                                                          │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │  [Avatar] @spammer123                                             │   │
│  │  spam@example.com                                                 │   │
│  │  Роль: USER  •  Karma: -45  •  С: 01.12.2025                     │   │
│  │  Статус: ⛔ Забанен (до 15.12.2025)                               │   │
│  │                                                                   │   │
│  │  [👁 Просмотр] [✏️ Роль ▼] [🔓 Разбанить] [🗑 Удалить]           │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│                                                                          │
│  Страница: [1] 2 3 4 5 ... 100                                          │
│                                                                          │
└────────────────────────────────────────────────────────────────────────┘
```

### Управление ролями

```
┌────────────────────────────────────────────────────────────────────────┐
│  👤 Изменение роли: @username                                           │
├────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  Текущая роль: AUTHOR                                                   │
│                                                                          │
│  Новая роль:                                                            │
│  ○ USER — Базовые права                                                 │
│  ● AUTHOR — Публикация контента (текущая)                               │
│  ○ MODERATOR — Модерация контента                                       │
│  ○ EDITOR — Редакция                                                    │
│  ○ ADMIN — Полный доступ                                                │
│                                                                          │
│  ⚠️ При назначении роли MODERATOR+ пользователь получит доступ         │
│  к административным функциям.                                           │
│                                                                          │
│  Причина изменения:                                                     │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │  Повышение за активный вклад в сообщество                        │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│                                                                          │
│  [Отмена]                                      [Сохранить изменения]    │
│                                                                          │
└────────────────────────────────────────────────────────────────────────┘
```

### Глобальные настройки платформы

```
┌────────────────────────────────────────────────────────────────────────┐
│  ⚙️ Глобальные настройки                                                │
├─────────────────┬──────────────────────────────────────────────────────┤
│                 │                                                        │
│  📝 Контент     │  НАСТРОЙКИ КОНТЕНТА                                   │
│                 │                                                        │
│  👥 Регистрация │  Режим публикации:                                    │
│                 │  ○ Свободный — все могут публиковать                  │
│  🛡️ Модерация   │  ● UGC с премодерацией — новые авторы проходят        │
│                 │     модерацию                                          │
│  🔒 Безопасность│  ○ Только редакция — публикует только редакция       │
│                 │                                                        │
│  📧 Email       │  ─────────────────────────────────────────────────    │
│                 │                                                        │
│  🔗 Интеграции  │  Автоматическое повышение до AUTHOR:                  │
│                 │  ☑ Включено                                            │
│                 │                                                        │
│                 │  Требования:                                           │
│                 │  Минимальная karma: [50]                              │
│                 │  Дней с регистрации: [14]                             │
│                 │  Опубликованных статей: [3]                           │
│                 │  Макс. % отклонённых: [30]                            │
│                 │                                                        │
│                 │  ─────────────────────────────────────────────────    │
│                 │                                                        │
│                 │  NSFW-контент:                                         │
│                 │  ○ Запрещён                                            │
│                 │  ● Разрешён со скрытием                               │
│                 │  ○ Разрешён без ограничений                           │
│                 │                                                        │
│                 │  [Сохранить изменения]                                │
│                 │                                                        │
└─────────────────┴──────────────────────────────────────────────────────┘
```

---

## Система модерации

### Типы модерации

```
┌────────────────────────────────────────────────────────────────────────┐
│                          СИСТЕМА МОДЕРАЦИИ                              │
├────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                     АВТОМОДЕРАЦИЯ                                │    │
│  │  • Антиспам (Akismet/собственная ML-модель)                     │    │
│  │  • Проверка на мат и оскорбления (словарь + ML)                 │    │
│  │  • Детекция NSFW-изображений                                    │    │
│  │  • Проверка дубликатов контента                                 │    │
│  │  • Обнаружение накрутки (реакции, комментарии)                  │    │
│  └──────────────────────────────────────────┬──────────────────────┘    │
│                                              │                           │
│                                              ▼                           │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                     ПРЕМОДЕРАЦИЯ                                 │    │
│  │  • Контент от новых пользователей                               │    │
│  │  • Контент с триггерами автомодерации                           │    │
│  │  • Подсайты с обязательной модерацией                           │    │
│  └──────────────────────────────────────────┬──────────────────────┘    │
│                                              │                           │
│                                              ▼                           │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                     ПОСТМОДЕРАЦИЯ                                │    │
│  │  • Обработка жалоб пользователей                                │    │
│  │  • Мониторинг популярного контента                              │    │
│  │  • Периодический аудит                                          │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                          │
└────────────────────────────────────────────────────────────────────────┘
```

### Очередь модерации

```
┌────────────────────────────────────────────────────────────────────────┐
│  📋 Очередь модерации                                   [Настройки]    │
├────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  Фильтры:                                                               │
│  [Все ▼] [Статьи ▼] [Комментарии ▼] [Срочность ▼]                      │
│                                                                          │
│  Сортировка: [По времени ▼]  Подсайт: [Все ▼]                          │
│                                                                          │
│  ─────────────────────────────────────────────────────────────────────  │
│                                                                          │
│  🔴 СРОЧНО (3)                                                          │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │  [!] Жалоба на статью (5 жалоб)              15 мин назад        │   │
│  │  "Мошенничество с криптой на нейросетях"                         │   │
│  │  @suspicious_user • 💰 Инвестиции                                │   │
│  │  Триггер: Множественные жалобы                                   │   │
│  │                                        [Просмотр] [Скрыть] [OK]  │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│                                                                          │
│  🟡 ОБЫЧНЫЕ (20)                                                        │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │  [?] Новая статья (премодерация)             1ч назад            │   │
│  │  "Мой первый опыт с Midjourney"                                  │   │
│  │  @newbie2025 • 🎨 Изображения                                    │   │
│  │  Триггер: Новый автор (karma: 12)                                │   │
│  │                                    [Просмотр] [Одобрить] [Откл.]  │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│                                                                          │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │  [?] Новая статья (автомодерация)            2ч назад            │   │
│  │  "Claude 3.5 — революция или хайп?"                              │   │
│  │  @techwriter • 💬 Чат-боты                                       │   │
│  │  Триггер: Обнаружен возможный спам (ссылки)                      │   │
│  │                                    [Просмотр] [Одобрить] [Откл.]  │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│                                                                          │
└────────────────────────────────────────────────────────────────────────┘
```

### Правила автомодерации

```
┌────────────────────────────────────────────────────────────────────────┐
│  🤖 Настройки автомодерации                                             │
├────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  АНТИСПАМ                                                               │
│  ☑ Включён                                                              │
│                                                                          │
│  Действие при обнаружении спама:                                        │
│  ○ Автоотклонение                                                       │
│  ● Отправить на модерацию                                               │
│  ○ Только пометить                                                      │
│                                                                          │
│  ─────────────────────────────────────────────────────────────────────  │
│                                                                          │
│  ФИЛЬТР СЛОВ                                                            │
│  ☑ Включён                                                              │
│                                                                          │
│  Запрещённые слова: [Редактировать список]                              │
│  Действие: ● Заменить на *** ○ Блокировать публикацию                  │
│                                                                          │
│  ─────────────────────────────────────────────────────────────────────  │
│                                                                          │
│  NSFW-ДЕТЕКЦИЯ                                                          │
│  ☑ Включена                                                             │
│                                                                          │
│  Порог срабатывания: [0.8] (0-1)                                        │
│  Действие: ● Отметить NSFW ○ Отправить на модерацию ○ Блокировать      │
│                                                                          │
│  ─────────────────────────────────────────────────────────────────────  │
│                                                                          │
│  ДУБЛИКАТЫ                                                              │
│  ☑ Проверка на плагиат/копипаст                                         │
│                                                                          │
│  Порог совпадения: [70]% текста                                         │
│  Действие: ● Предупреждение ○ Блокировать                              │
│                                                                          │
│  ─────────────────────────────────────────────────────────────────────  │
│                                                                          │
│  ССЫЛКИ                                                                  │
│  ☑ Проверка внешних ссылок                                              │
│                                                                          │
│  Белый список доменов: [Редактировать]                                  │
│  Макс. ссылок для новых авторов: [2]                                    │
│  Действие при превышении: ● На модерацию ○ Блокировать                 │
│                                                                          │
│  [Сохранить настройки]                                                  │
│                                                                          │
└────────────────────────────────────────────────────────────────────────┘
```

### Обработка жалоб

```
┌────────────────────────────────────────────────────────────────────────┐
│  🚨 Жалоба #12345                                                       │
├────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  Статус: 🟡 На рассмотрении                                             │
│  Дата: 15.11.2025, 14:30                                                │
│  Количество жалоб: 5                                                    │
│                                                                          │
│  ─────────────────────────────────────────────────────────────────────  │
│                                                                          │
│  ОБЪЕКТ ЖАЛОБЫ                                                          │
│  Тип: Статья                                                            │
│  Заголовок: "Как заработать миллион на ChatGPT за неделю"              │
│  Автор: @get_rich_quick                                                 │
│  Подсайт: 💰 Бизнес                                                     │
│                                                                          │
│  [Открыть статью]                                                       │
│                                                                          │
│  ─────────────────────────────────────────────────────────────────────  │
│                                                                          │
│  ПРИЧИНЫ ЖАЛОБ                                                          │
│  • Спам/Реклама: 3 жалобы                                               │
│  • Мошенничество: 2 жалобы                                              │
│                                                                          │
│  ─────────────────────────────────────────────────────────────────────  │
│                                                                          │
│  ИСТОРИЯ АВТОРА                                                         │
│  • Регистрация: 10.11.2025 (5 дней назад)                               │
│  • Karma: -12                                                            │
│  • Статей: 3 (2 скрыты)                                                 │
│  • Предупреждений: 1                                                    │
│                                                                          │
│  ─────────────────────────────────────────────────────────────────────  │
│                                                                          │
│  РЕШЕНИЕ                                                                 │
│                                                                          │
│  ○ Оставить (жалоба необоснована)                                       │
│  ○ Скрыть статью                                                        │
│  ● Скрыть статью + предупреждение автору                               │
│  ○ Скрыть статью + бан автора                                          │
│                                                                          │
│  Комментарий модератора:                                                │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │  Статья нарушает правила: реклама без пометки, вводящие         │   │
│  │  в заблуждение обещания.                                         │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│                                                                          │
│  [Закрыть жалобу]                                   [Эскалировать]      │
│                                                                          │
└────────────────────────────────────────────────────────────────────────┘
```

### Типы жалоб

| Категория | Описание | Приоритет |
|-----------|----------|-----------|
| **Спам** | Нежелательная реклама, накрутка | Высокий |
| **Оскорбления** | Оскорбительный контент, буллинг | Высокий |
| **Мошенничество** | Обман, фишинг | Критический |
| **Нарушение авторских прав** | Плагиат, копипаст | Средний |
| **Неактуальная информация** | Устаревшие данные | Низкий |
| **Неправильная категория** | Пост не по теме подсайта | Низкий |
| **NSFW без пометки** | Контент 18+ без маркировки | Средний |
| **Личные данные** | Doxxing, приватная информация | Критический |

---

## Управление подсайтами

### Типы подсайтов

```
┌────────────────────────────────────────────────────────────────────────┐
│                         ТИПЫ ПОДСАЙТОВ                                  │
├────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  🏛️ ОФИЦИАЛЬНЫЕ                                                        │
│  Создаются и управляются администрацией платформы.                      │
│  • 💬 Чат-боты                                                          │
│  • 🎨 Изображения                                                       │
│  • 🎬 Видео                                                             │
│  • 📰 Новости                                                           │
│  • 📖 Гайды                                                             │
│  и другие базовые категории                                             │
│                                                                          │
│  👥 СООБЩЕСТВА (будущее)                                                │
│  Создаются пользователями (при наличии прав).                           │
│  • Нишевые темы                                                         │
│  • Локальные сообщества                                                 │
│  • Корпоративные блоги                                                  │
│                                                                          │
│  🏢 КОМПАНИИ (будущее)                                                  │
│  Верифицированные страницы компаний.                                    │
│  • Официальные блоги                                                    │
│  • Пресс-релизы                                                         │
│  • Поддержка продуктов                                                  │
│                                                                          │
└────────────────────────────────────────────────────────────────────────┘
```

### Управление подсайтом (для владельца/редактора)

```
┌────────────────────────────────────────────────────────────────────────┐
│  ⚙️ Настройки подсайта: 💬 Чат-боты                                    │
├─────────────────┬──────────────────────────────────────────────────────┤
│                 │                                                        │
│  📝 Основное    │  ОСНОВНЫЕ НАСТРОЙКИ                                   │
│                 │                                                        │
│  👥 Команда     │  Название                                              │
│                 │  ┌──────────────────────────────────────────────────┐ │
│  🛡️ Модерация   │  │  Чат-боты                                        │ │
│                 │  └──────────────────────────────────────────────────┘ │
│  📊 Аналитика   │                                                        │
│                 │  Описание                                              │
│  🎨 Оформление  │  ┌──────────────────────────────────────────────────┐ │
│                 │  │  ChatGPT, Claude, Gemini — гайды, промпты,       │ │
│                 │  │  сравнения и обсуждения чат-ботов                │ │
│                 │  └──────────────────────────────────────────────────┘ │
│                 │                                                        │
│                 │  Slug                                                  │
│                 │  neurogen.news/[ chatbots ]                           │
│                 │                                                        │
│                 │  Иконка                                                │
│                 │  [💬] [Изменить]                                       │
│                 │                                                        │
│                 │  Обложка                                               │
│                 │  [Загрузить]                                           │
│                 │                                                        │
│                 │                              [Сохранить]              │
│                 │                                                        │
└─────────────────┴──────────────────────────────────────────────────────┘
```

### Команда подсайта

```
┌────────────────────────────────────────────────────────────────────────┐
│  👥 Команда подсайта: 💬 Чат-боты                                       │
├────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ВЛАДЕЛЕЦ                                                               │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │  [Avatar] @admin                                    👑 Владелец   │   │
│  │  Полный доступ к управлению подсайтом                            │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│                                                                          │
│  РЕДАКТОРЫ                                                              │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │  [Avatar] @editor1                                  ✏️ Редактор   │   │
│  │  Может редактировать контент и модерировать                       │   │
│  │                                                     [Удалить]    │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │  [Avatar] @editor2                                  ✏️ Редактор   │   │
│  │  Может редактировать контент и модерировать                       │   │
│  │                                                     [Удалить]    │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│                                                                          │
│  МОДЕРАТОРЫ                                                             │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │  [Avatar] @mod1                                     🛡️ Модератор  │   │
│  │  Может скрывать контент и банить в подсайте                      │   │
│  │                                                     [Удалить]    │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│                                                                          │
│  [+ Добавить члена команды]                                             │
│                                                                          │
└────────────────────────────────────────────────────────────────────────┘
```

### Настройки модерации подсайта

```
┌────────────────────────────────────────────────────────────────────────┐
│  🛡️ Модерация подсайта: 💬 Чат-боты                                    │
├────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  РЕЖИМ ПУБЛИКАЦИИ                                                       │
│                                                                          │
│  ○ Свободная публикация                                                 │
│    Любой автор может публиковать без модерации                          │
│                                                                          │
│  ● Премодерация для новых авторов                                       │
│    Авторы с karma < 50 проходят модерацию                              │
│                                                                          │
│  ○ Полная премодерация                                                  │
│    Все публикации проходят модерацию                                    │
│                                                                          │
│  ○ Только приглашённые                                                  │
│    Публиковать могут только члены команды                               │
│                                                                          │
│  ─────────────────────────────────────────────────────────────────────  │
│                                                                          │
│  ПРАВИЛА ПОДСАЙТА                                                       │
│                                                                          │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │  1. Контент должен быть связан с чат-ботами и LLM               │   │
│  │  2. Запрещена реклама без пометки                                │   │
│  │  3. Обязательно указывать источники                              │   │
│  │  4. Не допускаются дубликаты                                     │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│                                                                          │
│  Правила отображаются при создании поста в этот подсайт.               │
│                                                                          │
│  ─────────────────────────────────────────────────────────────────────  │
│                                                                          │
│  ОГРАНИЧЕНИЯ                                                            │
│                                                                          │
│  ☑ Проверять ссылки на белый список                                    │
│    Белый список: [openai.com, anthropic.com, ...]  [Редактировать]     │
│                                                                          │
│  ☐ Запретить изображения (только текст)                                │
│                                                                          │
│  ☐ Требовать теги                                                       │
│                                                                          │
│  ☑ Ограничить типы контента                                             │
│    Разрешены: [Статья] [Гайд] [Вопрос]  Запрещены: [Мем] [Обсуждение]  │
│                                                                          │
│  [Сохранить настройки]                                                  │
│                                                                          │
└────────────────────────────────────────────────────────────────────────┘
```

### Аналитика подсайта

```
┌────────────────────────────────────────────────────────────────────────┐
│  📊 Аналитика: 💬 Чат-боты                              [Экспорт]      │
├────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  Период: [Последние 30 дней ▼]                                          │
│                                                                          │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐   │
│  │   28,299     │ │    456       │ │   12,456     │ │    1,234     │   │
│  │ Подписчиков  │ │   Статей     │ │  Просмотров  │ │ Комментариев │   │
│  │   ▲ +12%     │ │   ▲ +8%      │ │    ▲ +24%    │ │   ▲ +15%     │   │
│  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘   │
│                                                                          │
│  📈 ДИНАМИКА ПОДПИСОК                                                   │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │  [График: подписки/отписки за период]                            │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│                                                                          │
│  🏆 ТОП АВТОРОВ                                                         │
│  1. @expert_ai — 45 статей, 12K просмотров                              │
│  2. @chatgpt_guru — 32 статьи, 8.5K просмотров                          │
│  3. @prompts_master — 28 статей, 6K просмотров                          │
│                                                                          │
│  📊 ТИПЫ КОНТЕНТА                                                       │
│  • Гайды: 45%                                                           │
│  • Обзоры: 30%                                                          │
│  • Вопросы: 15%                                                         │
│  • Новости: 10%                                                         │
│                                                                          │
└────────────────────────────────────────────────────────────────────────┘
```

---

## Схема базы данных (дополнения)

### Новые таблицы для модерации

```prisma
// Действия модерации
model ModerationAction {
  id            String           @id @default(cuid())
  
  // Кто выполнил
  moderator     User             @relation("moderator", fields: [moderatorId], references: [id])
  moderatorId   String
  
  // Над кем/чем
  targetType    ModerationTarget // USER, ARTICLE, COMMENT
  targetId      String
  
  // Что сделано
  action        ModActionType
  reason        String?
  details       Json?
  
  // Сроки (для банов)
  expiresAt     DateTime?
  
  // Связь с жалобой (если есть)
  reportId      String?
  report        Report?          @relation(fields: [reportId], references: [id])
  
  createdAt     DateTime         @default(now())
  
  @@index([moderatorId])
  @@index([targetType, targetId])
  @@index([createdAt])
}

enum ModerationTarget {
  USER
  ARTICLE
  COMMENT
}

enum ModActionType {
  // Контент
  APPROVE
  REJECT
  HIDE
  RESTORE
  MOVE
  PIN
  UNPIN
  MARK_NSFW
  
  // Пользователи
  WARNING
  MUTE
  COMMENT_BAN
  TEMP_BAN
  PERM_BAN
  SHADOW_BAN
  UNBAN
  
  // Редактирование
  EDIT
  
  // Роли
  ROLE_CHANGE
}

// Жалобы
model Report {
  id            String        @id @default(cuid())
  
  // Кто подал
  reporter      User          @relation("reporter", fields: [reporterId], references: [id])
  reporterId    String
  
  // На что жалоба
  targetType    ReportTarget
  targetId      String
  
  // Причина
  reason        ReportReason
  description   String?
  
  // Статус
  status        ReportStatus  @default(PENDING)
  
  // Обработка
  moderator     User?         @relation("moderator", fields: [moderatorId], references: [id])
  moderatorId   String?
  resolution    String?
  
  // Связанные действия
  actions       ModerationAction[]
  
  createdAt     DateTime      @default(now())
  resolvedAt    DateTime?
  
  @@index([status])
  @@index([targetType, targetId])
  @@index([reporterId])
}

enum ReportTarget {
  ARTICLE
  COMMENT
  USER
  MESSAGE
}

enum ReportReason {
  SPAM
  OFFENSIVE
  FRAUD
  COPYRIGHT
  OUTDATED
  OFF_TOPIC
  NSFW_UNMARKED
  PERSONAL_DATA
  OTHER
}

enum ReportStatus {
  PENDING
  IN_REVIEW
  RESOLVED
  DISMISSED
  ESCALATED
}

// Баны пользователей
model UserBan {
  id            String      @id @default(cuid())
  
  user          User        @relation(fields: [userId], references: [id])
  userId        String
  
  // Тип бана
  type          BanType
  
  // Причина
  reason        String
  
  // Кто забанил
  bannedBy      User        @relation("bannedBy", fields: [bannedById], references: [id])
  bannedById    String
  
  // Сроки
  startsAt      DateTime    @default(now())
  expiresAt     DateTime?   // null = постоянный
  
  // Статус
  isActive      Boolean     @default(true)
  
  // Апелляция
  appealText    String?
  appealStatus  AppealStatus?
  appealedAt    DateTime?
  
  createdAt     DateTime    @default(now())
  
  @@index([userId, isActive])
  @@index([expiresAt])
}

enum BanType {
  COMMENT_BAN   // Запрет комментировать
  POST_BAN      // Запрет публиковать
  TEMP_BAN      // Временный полный бан
  PERM_BAN      // Постоянный бан
  SHADOW_BAN    // Скрытый бан
  SUBSITE_BAN   // Бан в конкретном подсайте
}

enum AppealStatus {
  PENDING
  APPROVED
  REJECTED
}
```

### Расширение Subsite

```prisma
model Subsite {
  id            String    @id @default(cuid())
  slug          String    @unique
  name          String
  description   String?
  icon          String?
  coverUrl      String?
  
  // Тип
  type          SubsiteType @default(OFFICIAL)
  
  // Владелец (для сообществ)
  owner         User?     @relation("subsiteOwner", fields: [ownerId], references: [id])
  ownerId       String?
  
  // Команда
  team          SubsiteTeamMember[]
  
  // Настройки
  settings      Json      @default("{}")
  
  // Модерация
  moderationMode ModerationMode @default(PREMOD_NEW)
  rules         String?   // Markdown с правилами
  
  // Ограничения
  allowedContentTypes ContentType[]
  whitelistedDomains  String[]
  
  // Флаги
  isOfficial    Boolean   @default(false)
  isHidden      Boolean   @default(false)
  isArchived    Boolean   @default(false)
  requiresInvite Boolean  @default(false)
  
  // Счётчики
  subscriberCount Int     @default(0)
  articleCount    Int     @default(0)
  
  // Связи
  articles      Article[]
  subscriptions SubsiteSubscription[]
  bans          SubsiteBan[]
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@index([slug])
  @@index([type])
}

enum SubsiteType {
  OFFICIAL      // Официальный подсайт платформы
  COMMUNITY     // Созданный пользователем
  COMPANY       // Корпоративный блог
}

enum ModerationMode {
  FREE          // Без модерации
  PREMOD_NEW    // Премодерация для новых авторов
  PREMOD_ALL    // Полная премодерация
  INVITE_ONLY   // Только по приглашению
}

// Команда подсайта
model SubsiteTeamMember {
  id            String         @id @default(cuid())
  
  subsite       Subsite        @relation(fields: [subsiteId], references: [id])
  subsiteId     String
  
  user          User           @relation(fields: [userId], references: [id])
  userId        String
  
  role          SubsiteRole
  
  // Кто добавил
  addedBy       User           @relation("addedBy", fields: [addedById], references: [id])
  addedById     String
  
  createdAt     DateTime       @default(now())
  
  @@unique([subsiteId, userId])
  @@index([subsiteId])
  @@index([userId])
}

enum SubsiteRole {
  OWNER         // Владелец (полные права)
  EDITOR        // Редактор (может редактировать контент)
  MODERATOR     // Модератор (может модерировать)
}

// Бан в подсайте
model SubsiteBan {
  id            String    @id @default(cuid())
  
  subsite       Subsite   @relation(fields: [subsiteId], references: [id])
  subsiteId     String
  
  user          User      @relation(fields: [userId], references: [id])
  userId        String
  
  reason        String
  
  bannedBy      User      @relation("subsiteBannedBy", fields: [bannedById], references: [id])
  bannedById    String
  
  expiresAt     DateTime?
  isActive      Boolean   @default(true)
  
  createdAt     DateTime  @default(now())
  
  @@unique([subsiteId, userId])
  @@index([subsiteId, isActive])
}
```

### Расширение Article

```prisma
model Article {
  // ... существующие поля ...
  
  // Модерация
  moderationStatus ModerationStatus @default(PENDING)
  moderatedBy      User?            @relation("moderatedBy", fields: [moderatedById], references: [id])
  moderatedById    String?
  moderatedAt      DateTime?
  rejectionReason  String?
  
  // Версионирование
  version          Int              @default(1)
  versions         ArticleVersion[]
  
  // Флаги
  isNSFW          Boolean          @default(false)
  isSponsored     Boolean          @default(false)
  isPinned        Boolean          @default(false)
  isLocked        Boolean          @default(false) // Комментарии закрыты
  
  // История модерации
  moderationHistory ModerationAction[]
}

enum ModerationStatus {
  PENDING       // Ожидает модерации
  APPROVED      // Одобрено
  REJECTED      // Отклонено
  AUTO_APPROVED // Авто-одобрено (доверенный автор)
}

// История версий статьи
model ArticleVersion {
  id            String   @id @default(cuid())
  
  article       Article  @relation(fields: [articleId], references: [id])
  articleId     String
  
  version       Int
  title         String
  content       Json
  
  // Кто изменил
  editedBy      User     @relation(fields: [editedById], references: [id])
  editedById    String
  
  // Причина изменения
  changeReason  String?
  
  createdAt     DateTime @default(now())
  
  @@unique([articleId, version])
  @@index([articleId])
}
```

---

## API Endpoints (дополнения)

### Модерация

```typescript
// Очередь модерации
GET    /api/admin/moderation/queue
GET    /api/admin/moderation/queue?type=article&status=pending

// Действия модерации
POST   /api/admin/moderation/articles/:id/approve
POST   /api/admin/moderation/articles/:id/reject
POST   /api/admin/moderation/articles/:id/hide
POST   /api/admin/moderation/articles/:id/restore

// Жалобы
GET    /api/admin/reports
GET    /api/admin/reports/:id
POST   /api/admin/reports/:id/resolve
POST   /api/admin/reports/:id/escalate

// Баны
POST   /api/admin/users/:id/ban
POST   /api/admin/users/:id/unban
GET    /api/admin/users/:id/bans

// История модерации
GET    /api/admin/moderation/history
GET    /api/admin/moderation/history?moderator=:id
GET    /api/admin/moderation/history?target=user:id
```

### Управление пользователями

```typescript
// Список пользователей
GET    /api/admin/users
GET    /api/admin/users?role=AUTHOR&status=active

// Управление ролями
PUT    /api/admin/users/:id/role

// Детали пользователя (для модератора)
GET    /api/admin/users/:id/details
GET    /api/admin/users/:id/moderation-history
```

### Управление подсайтами

```typescript
// CRUD подсайтов
GET    /api/admin/subsites
POST   /api/admin/subsites
PUT    /api/admin/subsites/:id
DELETE /api/admin/subsites/:id

// Команда подсайта
GET    /api/subsites/:id/team
POST   /api/subsites/:id/team
DELETE /api/subsites/:id/team/:userId

// Настройки модерации подсайта
GET    /api/subsites/:id/settings
PUT    /api/subsites/:id/settings

// Баны в подсайте
POST   /api/subsites/:id/bans
DELETE /api/subsites/:id/bans/:userId
```

### Глобальные настройки

```typescript
// Настройки платформы
GET    /api/admin/settings
PUT    /api/admin/settings

// Настройки автомодерации
GET    /api/admin/settings/automod
PUT    /api/admin/settings/automod

// Логи системы
GET    /api/admin/logs
GET    /api/admin/logs/moderation
GET    /api/admin/logs/auth
```

---

## Связанные документы

| Документ | Описание |
|----------|----------|
| [01-OVERVIEW.md](./01-OVERVIEW.md) | Обзор проекта |
| [02-ARCHITECTURE.md](./02-ARCHITECTURE.md) | Архитектура системы |
| [03-FEATURES.md](./03-FEATURES.md) | Функциональные требования |
| [05-USER-FLOWS.md](./05-USER-FLOWS.md) | Пользовательские сценарии |
| [06-DATABASE-SCHEMA.md](./06-DATABASE-SCHEMA.md) | Схема базы данных |


